<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ========== 增值税发票视图 ========== -->
    <record id="vat_invoice_view_form" model="ir.ui.view">
        <field name="name">vat.invoice.form</field>
        <field name="model">vat.invoice</field>
        <field name="arch" type="xml">
            <form string="增值税发票">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="基本信息">
                            <field name="invoice_code"/>
                            <field name="invoice_number"/>
                            <field name="invoice_date"/>
                            <field name="invoice_type"/>
                        </group>
                        <group string="金额信息">
                            <field name="amount"/>
                            <field name="amount_without_tax"/>
                            <field name="tax_amount"/>
                            <field name="tax_rate"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="销售方信息">
                            <field name="vendor_name"/>
                            <field name="vendor_tax_id"/>
                            <field name="vendor_address"/>
                            <field name="vendor_bank"/>
                        </group>
                        <group string="购买方信息">
                            <field name="purchaser_name"/>
                            <field name="purchaser_tax_id"/>
                            <field name="purchaser_address"/>
                            <field name="purchaser_bank"/>
                        </group>
                    </group>
<!--                     
                    <group string="商品信息">
                        <field name="commodity_name"/>
                        <field name="commodity_type"/>
                        <field name="commodity_unit"/>
                        <field name="commodity_quantity"/>
                        <field name="commodity_price"/>
                        <field name="commodity_amount"/>
                    </group> -->
                    
                    <group>
                        <group string="其他信息">
                            <field name="drawer"/>
                            <field name="payee"/>
                            <field name="checker"/>
                        </group>
                        <group string="关联信息">
                            <field name="expense_id" string="关联费用记录"/>
                            <field name="amount_in_words"/>
                        </group>
                    </group>
                    
                    <group string="备注">
                        <field name="remarks" nolabel="1"/>
                    </group>
                    
                    <notebook>
                        <page string="OCR原始数据" groups="base.group_no_one">
                            <field name="ocr_raw_data" widget="text"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="vat_invoice_view_tree" model="ir.ui.view">
        <field name="name">vat.invoice.tree</field>
        <field name="model">vat.invoice</field>
        <field name="arch" type="xml">
            <tree string="增值税发票">
                <field name="invoice_number"/>
                <field name="invoice_date"/>
                <field name="vendor_name"/>
                <field name="purchaser_name"/>
                <field name="amount" sum="总金额"/>
                <field name="tax_rate"/>
                <field name="expense_id"/>
            </tree>
        </field>
    </record>

    <record id="vat_invoice_action" model="ir.actions.act_window">
        <field name="name">增值税发票</field>
        <field name="res_model">vat.invoice</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                还没有增值税发票记录
            </p>
            <p>
                通过费用报销单的OCR识别功能可以自动创建增值税发票记录。
            </p>
        </field>
    </record>

    <!-- ========== 火车票视图 ========== -->
    <record id="train_ticket_view_form" model="ir.ui.view">
        <field name="name">train.ticket.form</field>
        <field name="model">train.ticket</field>
        <field name="arch" type="xml">
            <form string="火车票">
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="基本信息">
                            <field name="ticket_number"/>
                            <field name="train_number"/>
                            <field name="date"/>
                            <field name="amount"/>
                        </group>
                        <group string="行程信息">
                            <field name="origin"/>
                            <field name="destination"/>
                            <field name="departure_time"/>
                            <field name="arrival_time"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="座位信息">
                            <field name="seat_type"/>
                            <field name="seat_number"/>
                        </group>
                        <group string="乘客信息">
                            <field name="passenger_name"/>
                            <field name="passenger_id"/>
                        </group>
                        <group string="关联信息">
                            <field name="expense_id" string="关联费用记录"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="OCR原始数据" groups="base.group_no_one">
                            <field name="ocr_raw_data" widget="text"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="train_ticket_view_tree" model="ir.ui.view">
        <field name="name">train.ticket.tree</field>
        <field name="model">train.ticket</field>
        <field name="arch" type="xml">
            <tree string="火车票">
                <field name="ticket_number"/>
                <field name="train_number"/>
                <field name="origin"/>
                <field name="destination"/>
                <field name="departure_time"/>
                <field name="passenger_name"/>
                <field name="amount" sum="总金额"/>
                <field name="expense_id"/>
            </tree>
        </field>
    </record>

    <record id="train_ticket_action" model="ir.actions.act_window">
        <field name="name">火车票</field>
        <field name="res_model">train.ticket</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                还没有火车票记录
            </p>
            <p>
                通过费用报销单的OCR识别功能可以自动创建火车票记录。
            </p>
        </field>
    </record>

    <!-- OCR识别专用动作 -->
    <record id="action_ocr_recognize_direct" model="ir.actions.act_window">
        <field name="name">OCR票据识别</field>
        <field name="res_model">ocr.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                上传票据文件进行OCR识别
            </p>
            <p>
                支持增值税发票、火车票等多种票据类型的自动识别。
            </p>
        </field>
    </record>

    <!-- ========== 菜单结构 ========== -->
    <menuitem id="ticket_menu_root" 
              name="票据管理" 
              parent="hr_expense.menu_hr_expense_root" 
              sequence="15"/>
    
    <!-- 添加OCR识别菜单 -->
    <menuitem id="ocr_recognize_menu" 
              name="OCR识别" 
              parent="ticket_menu_root" 
              action="action_ocr_recognize_direct"
              sequence="5"/>
              
    <menuitem id="vat_invoice_menu" 
              name="增值税发票" 
              parent="ticket_menu_root" 
              action="vat_invoice_action" 
              sequence="10"/>
              
    <menuitem id="train_ticket_menu" 
              name="火车票" 
              parent="ticket_menu_root" 
              action="train_ticket_action" 
              sequence="20"/>
</odoo>