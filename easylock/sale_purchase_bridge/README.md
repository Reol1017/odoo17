# 销售采购桥接模块

## 功能介绍

销售采购桥接模块（sale_purchase_bridge）提供了销售订单和采购订单之间的桥接功能，实现从销售到采购的完整流程管理。

## 主要功能

1. 从销售订单创建采购请求
2. 采购请求根据需求创建采购订单
3. 支持分批次采购和多供应商采购
4. 自动追踪采购和收货状态
5. 提供完整的状态流转和追踪

## 状态流转规则

### 销售采购请求单（Request）状态流转规则

1. **草稿(draft)**: 初始状态，请求单刚创建但尚未确认
2. **等待采购处理(waiting)**: 已确认的请求单，等待采购部门处理
3. **采购中(purchasing)**: 请求单中至少有一条采购请求行处于部分采购或已采购状态，但未全部完成采购
4. **采购完成(purchased)**: 请求单中所有请求行都已完成采购（无剩余数量），但尚未全部收货
5. **已完成(done)**: 请求单中所有请求行都已完成收货
6. **已取消(cancel)**: 请求单被取消

### 请求行（Request Line）状态流转规则

1. **等待处理(waiting)**: 尚未创建采购订单
2. **部分采购(partial)**: 已经有采购订单但还有剩余数量待采购
3. **已采购(purchased)**: 已完成全部采购（无剩余数量）但尚未完全收货
4. **已完成(done)**: 所有采购订单行都已完成收货

## 使用说明

1. 在销售订单中，点击"创建采购请求"按钮生成采购请求
2. 采购人员在采购请求中处理需求，为请求行分配供应商并创建采购订单
3. 系统自动追踪采购状态和收货情况，更新请求单和请求行状态
4. 所有商品完成收货后，请求单状态自动更新为"已完成"

## 技术特点

1. 支持多对多关系，一个销售订单行可以对应多个采购订单行
2. 自动计算已采购数量和剩余数量
3. 状态自动变更，减少手动操作
4. 提供完整的采购历史追踪 